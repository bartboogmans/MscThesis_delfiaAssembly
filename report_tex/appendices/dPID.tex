% This file was automatically created from the m-file 
% "m2tex.m" written by USL. 
% The fontencoding in this file is UTF-8. 
%  
% You will need to include the following two packages in 
% your LaTeX-Main-File. 
%  
% \usepackage{color} 
% \usepackage{fancyvrb} 
%  
% It is advised to use the following option for Inputenc 
% \usepackage[utf8]{inputenc} 
%  
  
% definition of matlab colors: 
\definecolor{mblue}{rgb}{0,0,1} 
\definecolor{mgreen}{rgb}{0.13333,0.5451,0.13333} 
\definecolor{mred}{rgb}{0.62745,0.12549,0.94118} 
\definecolor{mgrey}{rgb}{0.5,0.5,0.5} 
\definecolor{mdarkgrey}{rgb}{0.25,0.25,0.25} 
  
\DefineShortVerb[fontfamily=courier,fontseries=m]{\$} 
\DefineShortVerb[fontfamily=courier,fontseries=b]{\#} 
  
\noindent                                                                                              $$\color{mblue}$classdef$\color{black}$ dPID$\\ $$\color{mgreen}$%A simple discrete Proportional Integral and Derivative controller$\color{black}$$\\ $    $\color{mgreen}$%   dPID1 = dPID(10, 0.01, 2) Creates a discrete PID controller with$\color{black}$$\\ $    $\color{mgreen}$%   Kp, Ki, Kd = 10, 0.01 and 2. $\color{black}$$\\ $    $\color{mgreen}$%$\color{black}$$\\ $    $\color{mgreen}$%   y = dPID1.run(e,dt) calculates output y of dPID1 with given feed$\color{black}$$\\ $    $\color{mgreen}$%   error e after a timestep of dt. This callback needs to be called$\color{black}$$\\ $    $\color{mgreen}$%   repetitively by the system that uses this class$\color{black}$$\\ $    $\\ $    $\color{mgreen}$% (c) Bart Boogmans 2020/2021 bartboogmans@hotmail.com,$\color{black}$$\\ $    $\color{mgreen}$% You may use, distribute and modify this code under given that clear$\color{black}$$\\ $    $\color{mgreen}$% credit is given to the author's work. $\color{black}$$\\ $    $\color{mgreen}$%$\color{black}$$\\ $    $\color{mgreen}$% Developed in cooperation with the Researchlab Autonomous Shipping$\color{black}$$\\ $    $\color{mgreen}$% Delft & Department Maritime and Transport Technology of faculty 3mE, TU Delft. $\color{black}$$\\ $    $\color{mgreen}$% https://rasdelft.nl/nl/$\color{black}$$\\ $    $\color{mgreen}$%$\color{black}$$\\ $    $\color{mgreen}$% Changelog$\color{black}$$\\ $    $\color{mgreen}$% Last update 29/08/2021: commenting : Bart Boogmans$\color{black}$$\\ $    properties$\\ $        Kp$\\ $        Ki$\\ $        Kd$\\ $        integrator$\\ $        e_last$\\ $        interpolationStyle$\\ $        limits_set$\\ $        limit_upper$\\ $        limit_lower$\\ $        int_buildup_limit$\\ $    $\color{mblue}$end$\color{black}$$\\ $    $\\ $    methods$\\ $        $\color{mgreen}$% Constructor$\color{black}$$\\ $        $\color{mblue}$function$\color{black}$ obj = dPID(kp, ki, kd)$\\ $            obj.limits_set = false;$\\ $            obj.Kp =  kp;$\\ $            obj.Ki =  ki;$\\ $            obj.Kd =  kd;$\\ $            obj.integrator = 0;$\\ $            obj.e_last = 0;$\\ $            obj.interpolationStyle = $\color{mred}$'rectangle'$\color{black}$;$\\ $        $\color{mblue}$end$\color{black}$$\\ $        $\\ $        $\color{mgreen}$% Set PID output limits$\color{black}$$\\ $        $\color{mblue}$function$\color{black}$ obj = setlimits(obj,lower,upper)$\\ $            obj.limit_upper = upper;$\\ $            obj.limit_lower = lower;$\\ $            obj.limits_set = true;$\\ $        $\color{mblue}$end$\color{black}$$\\ $            $\\ $        $\color{mgreen}$% Runs an iteration of the PID controller$\color{black}$$\\ $        $\color{mblue}$function$\color{black}$ y = run(obj,e_new,dt)$\\ $            $\color{mblue}$if$\color{black}$ size(e_new,1) ~= 1 || size(e_new,2) ~= 1 || size(dt,1) ~= 1 || size(dt,2) ~= 1$\\ $                disp($\color{mred}$'input to dPID.run is incorrect size'$\color{black}$)$\\ $            $\color{mblue}$else$\color{black}$$\\ $               $\color{mblue}$if$\color{black}$ dt>0$\\ $                    $\color{mblue}$if$\color{black}$ strcmp(obj.interpolationStyle,$\color{mred}$'rectangle'$\color{black}$)$\\ $                        obj.integrator = obj.integrator + dt*e_new;$\\ $                    $\color{mblue}$elseif$\color{black}$ strcmp(obj.interpolationStyle,$\color{mred}$'trapezoidal'$\color{black}$)$\\ $                        obj.integrator = obj.integrator + dt*(e_new+obj.e_last)/2;$\\ $                    $\color{mblue}$end$\color{black}$$\\ $                    $\\ $                    $\color{mblue}$if$\color{black}$  ~isempty(obj.int_buildup_limit)$\\ $                        $\color{mblue}$if$\color{black}$ obj.integrator > obj.int_buildup_limit$\\ $                            obj.integrator = obj.int_buildup_limit;$\\ $                        $\color{mblue}$elseif$\color{black}$ obj.integrator < -obj.int_buildup_limit$\\ $                            obj.integrator = -obj.int_buildup_limit;$\\ $                        $\color{mblue}$end$\color{black}$$\\ $                    $\color{mblue}$end$\color{black}$$\\ $                    $\\ $                    y_proportional =    obj.Kp*         e_new;$\\ $                    y_derivative =      obj.Kd*         (e_new-obj.e_last)/dt;$\\ $                    y_integrator =      obj.Ki*         obj.integrator;$\\ $                    $\\ $                    obj.e_last = e_new;$\\ $                    y = y_proportional + y_integrator + y_derivative;$\\ $                    $\color{mblue}$if$\color{black}$ obj.limits_set$\\ $                        $\color{mblue}$if$\color{black}$ y>obj.limit_upper$\\ $                            y = obj.limit_upper;$\\ $                        $\color{mblue}$end$\color{black}$$\\ $                        $\color{mblue}$if$\color{black}$ y<obj.limit_lower$\\ $                            y = obj.limit_lower;$\\ $                        $\color{mblue}$end$\color{black}$$\\ $                    $\color{mblue}$end$\color{black}$$\\ $               $\color{mblue}$else$\color{black}$$\\ $                    disp($\color{mred}$'Warning: dt input of dPID<=0'$\color{black}$)$\\ $                    y =0;$\\ $                $\color{mblue}$end$\color{black}$$\\ $            $\color{mblue}$end$\color{black}$$\\ $        $\color{mblue}$end$\color{black}$$\\ $    $\color{mblue}$end$\color{black}$$\\ $$\color{mblue}$end$\color{black}$$\\ 
  
\UndefineShortVerb{\$} 
\UndefineShortVerb{\#}