var PushNotifications=function(e){"use strict";function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}function g(o){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),n.forEach(function(e){var n,t,r;n=o,r=i[t=e],t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r})}return o}var d=function(){function e(){n(this,e)}return t(e,null,[{key:"debug",value:function(){}},{key:"info",value:function(){}},{key:"warn",value:function(){var e;(e=console).warn.apply(e,arguments)}},{key:"error",value:function(){var e;(e=console).error.apply(e,arguments)}}]),e}(),o="pn_reg_later",i="pn_token",a="pn_sent",f=function(){function e(){n(this,e)}return t(e,null,[{key:"isSentToServer",value:function(){return null!=window.sessionStorage.getItem(a)}},{key:"setSentToServer",value:function(){window.sessionStorage.setItem(a,"true")}},{key:"removeToken",value:function(){window.localStorage.removeItem(i)}},{key:"setToken",value:function(e){null==e||"null"===e?this.removeToken():window.localStorage.setItem(i,e)}},{key:"getToken",value:function(){return window.localStorage.getItem(i)}},{key:"setReminder",value:function(){var e=new Date;e.setDate((new Date).getDate()+1),window.localStorage.setItem(o,String(e.getTime())),this.removeToken()}},{key:"shouldAskForRegistration",value:function(){var e=window.localStorage.getItem(o);if(!e)return!0;var n=new Date(parseInt(e));return Boolean(new Date>=n)}}]),e}(),v=function(){function e(){n(this,e)}return t(e,null,[{key:"send",value:function(n,e,t){var r=2<arguments.length&&void 0!==t?t:"POST";return fetch("https://push.prod.conrad24.com/pns/device/"+n,{method:r,headers:{"Content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){if(!e.ok)throw new Error("Http ".concat(r," request '").concat(n,"' could not be sent."),e);return e})}},{key:"sendToken",value:function(e,n,t,r){var o=3<arguments.length&&void 0!==r&&r,i=f.getToken();if(e&&(o||i!==e||!f.isSentToServer())){var a=n.trackingId,u=n.country,s=n.language,c=n.shopId;return this.send("register",{clickedRegister:t,token:e,prevToken:i,trackingId:a,userAgent:navigator.userAgent,platform:navigator.platform,geoRegion:u,language:s,shopId:c}).then(function(){f.setSentToServer(),f.setToken(e),d.debug("Token ".concat(e," sent to server."))}).catch(function(e){return d.error("Error on sending token to server.",e)})}}}]),e}();var u,s,c=null,l=function(n){h(function(){s.getToken().then(function(e){return v.sendToken(e,u,!1,n)}).catch(function(e){return d.error("Could not get token from FCM.",e)})})},p=function(){return new Promise(function(e,n){k("https://www.gstatic.com/firebasejs/5.7.0/firebase-app.js",function(){k("https://www.gstatic.com/firebasejs/5.7.0/firebase-messaging.js",function(){if(d.info("Firebase scripts were loaded."),!firebase)return n(-1);if(firebase.initializeApp({apiKey:"AIzaSyDG7ilWEaAZNti87TmXrHCT5Vm6gvc1R-g",authDomain:"ecom-push-prod.firebaseapp.com",projectId:"ecom-push-prod",storageBucket:"ecom-push-prod.appspot.com",messagingSenderId:"1089226526676"}),!firebase.messaging.isSupported())return n(-1);(s=firebase.messaging()).onTokenRefresh(function(){l(!0)}),s.onMessage(function(e){return d.info("Notification received in browser.",e),h(function(){return function(e,n,t,r){var o=2<arguments.length&&void 0!==t?t:null,i=3<arguments.length&&void 0!==r&&r,a=e.title,u=e.jobId,s=e.link,c="true"===e.silent;if(o&&o.getToken().then(function(e){v.send("ping",{jobId:u,token:e,sw:i,silent:c}).then(function(e){d.debug("Server ping for notification succeeded with response:",e)}).catch(function(e){return d.error("Server ping for received notification failed.",e)})}).catch(function(e){return d.error("Could not fetch token on push notification.",e)}),!c){if(n){var f=JSON.parse(e.notificationOptions),l=g({data:{jobId:u,link:s}},f);return d.debug("Notification '".concat(a,"' options:"),l),n.showNotification(a,l)}d.warn("No registration available.")}}(e.data,c,s)})}),e(0)},function(e){throw new Error("Firebase app script could not be loaded.",e)})},function(e){throw new Error("Firebase messaging script could not be loaded.",e)})})},h=function(n){return c?n():navigator.serviceWorker.getRegistration("/").then(function(e){return(e?e.update():navigator.serviceWorker.register("/messaging-sw.js")).then(function(e){return s.useServiceWorker(c=e),d.debug("Service worker installed."),n()})})};function k(e,n,t){var r=document.createElement("script");n&&(r.onload=n),t&&(r.onerror=t),r.src=e,document.head.appendChild(r)}return e.FAILURE=-1,e.SUCCESS=0,e.NOT_SUPPORTED=-1,e.NOT_REGISTERED=0,e.REGISTERED=1,e.BLOCKED=2,e.ABORTED=3,e.initialize=function(e,n,t,r){return u={trackingId:e,country:n,language:t,shopId:3<arguments.length&&void 0!==r?r:null},"Notification"in window&&"permissions"in navigator&&"serviceWorker"in navigator?navigator.permissions.query({name:"notifications"}).then(function(e){switch(d.info("Permission:",e),e.state){case"denied":return 2;case"granted":return p().then(function(){return l(!0),1});default:return f.shouldAskForRegistration()?0:3}}):Promise.reject(-1)},e.register=function(){return(s?Promise.resolve():p()).then(function(){return h(function(){return s.requestPermission().then(function(){return s.getToken().then(function(e){return d.debug("Registration successful. Token:",e),v.sendToken(e,u,!0,!0),1}).catch(function(e){return d.error("Registration on token request failed.",e),-1})}).catch(function(e){return d.error("Registration failed.",e),e.toString().includes("default")?3:2})})})},e.unregister=function(){if(!s)throw new Error("Firebase API was not initialized.");return s.getToken().then(function(e){if(e)return v.send("register",{token:e},"DELETE").then(function(){s.deleteToken(e)})}).then(function(){return d.debug("Token unregistered."),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration("/").then(function(e){return e.unregister()}),0})},e}({});